- hosts: localhost
  gather_facts: false
  tasks:
    - ansible.builtin.copy:
        src: tf
        dest: /tmp

    - ansible.builtin.tempfile:
        suffix: .tfplan
      register: plan_file

    - ansible.builtin.shell:
        cmd: "base64 --decode > {{ plan_file.path }}"
        stdin: "{{ terraform_plan }}"

    - cloud.terraform.terraform:
        force_init: true
        project_path: /tmp/tf
        plan_file: "{{ plan_file.path }}"

    - debug:
        msg: "{{ lookup('ansible.builtin.file', '/tmp/test') }}"
